<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>

</body>
<script>
    window.navigator.geolocation.getCurrentPosition((r) => {
        alert(res.coords.latitude)
        let lat = r.coords.latitude
        let lng = r.coords.longitude
        const pointBak = new window.BMap.Point(lng, lat)
        const convertor = new window.BMap.Convertor()
        convertor.translate([pointBak], 1, 5, function (resPoint) {
            if (resPoint && resPoint.points && resPoint.points.length > 0) {
                lng = resPoint.points[0].lng
                lat = resPoint.points[0].lat
                alert(lat)
            }
            const point = new window.BMap.Point(lng, lat)
            const geo = new window.BMap.Geocoder()
            geo.getLocation(point, (res) => {
                console.log(res)
            })
        })
    }, (e) => {
        switch (e.code) {
            case e.TIMEOUT:
                alert("定位失败，请求获取用户位置超时")
                break
            case e.PERMISSION_DENIED:
                alert("您拒绝了使用位置服务功能，查询已取消")
                break
            case e.POSITION_UNAVAILABLE:
                alert("抱歉，暂时无法为您所在的星球提供位置服务")
                break
            case e.UNKNOWN_ERROR:
                alert("发生一个位置错误")
                break
        }
    }, {
            //指示浏览器获取高精度的位置，默认false  
            enableHighAcuracy: true,
            //指定获取地理位置的超时时间，默认不限时，单位为毫秒  
            timeout: 5000,
            //最长有效期，在重复获取地理位置时，此参数指定多久再次获取位置  
            maximumAge: 2000
        })
</script>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
  />
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>直播6</title>
  <link rel="stylesheet" href="https://g.alicdn.com/de/prismplayer/2.5.1/skins/default/aliplayer-min.css" />
  <script type="text/javascript" src="https://g.alicdn.com/de/prismplayer/2.5.1/aliplayer-min.js"></script>
  <link rel="stylesheet" href="./css/common.css" />
  <link rel="stylesheet" href="./css/index.css" />
  <style>
    video {
      /*object-fit: contain !important;*/
    }
  </style>
  <script>
    (function () {
      document.documentElement.style.fontSize = document.documentElement.clientWidth / 7.5 + 'px';
    })();
  </script>
</head>

<body ontouchstart>
  <div class="container">
    <div class="player">
      <div class="player_header">
        <img src="./images/logo.png" alt="直播logo">
        <span>当前
          <b> 8792 </b>人观看直播</span>
      </div>
      <div class="prism-player" id="J_prismPlayer"></div>
      <div class="player_footer">
        <h3>WE2018春夏新品站展览1</h3>
        <p>直播嘉宾：
          <span>谢继东老师</span>
        </p>
        <p>直播时间：
          <span>2018.03.16 9:00 - 12:00</span>
        </p>
      </div>
    </div>
    <div class="chat_room" id="chatWrap">
      <div id="chatRoom">
        <div class="chat_box">
          <div class="chat_img">
            <img src="http://placeholder.qiniudn.com/60x60/3cc51f/ffffff" alt="">
          </div>
          <div class="chat_msg">
            <span>小蜡姬 16:42</span>
            <p>由各种物质组成的巨型球状天体</p>
          </div>
        </div>
        <div class="user_chat">
          <div class="chat_msg">
            <span>小蜡姬 16:42</span>
            <p>由各种物质组成的巨型球状天体</p>
          </div>
          <div class="chat_img">
            <img src="http://placeholder.qiniudn.com/60x60/3cc51f/ffffff" alt="">
          </div>
        </div>
      </div>
      <div class="sent_box" id="sentBox">
        <textarea autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" placeholder="说两句捧个场吧，限制30个字" cols="30" maxlength="30" id="msg"></textarea>
        <span id="sentBtn">发送</span>
      </div>
    </div>
  </div>
</body>
<script>
  var playerData = null;
  var player = new Aliplayer({
    id: "J_prismPlayer",
    autoplay: false,
    isLive: true,
    playsinline: true,
    width: "100%",
    height: "5.12rem",
    controlBarVisibility: "always",
    useH5Prism: true,
    useFlashPrism: false,
    source: "http://player.alicdn.com/video/aliyunmedia.mp4",
    //cover: "https://cdnoss.youkouyang.com/cover.png",//视频封面图
    x5_type: 'h5',
    x5_fullscreen: true, //全屏播放
    x5_orientation: 'landscape',
    skinLayout: [{
        "name": "bigPlayButton",
        "align": "cc"
      },
      {
        "name": "controlBar",
        "align": "blabs",
        "x": 0,
        "y": 0,
        "children": [{
            "name": "streamButton",
            "align": "tr",
            "x": 20,
            "y": 23
          },
          {
            "name": "fullScreenButton",
            "align": "tr",
            "x": 10,
            "y": 10
          }
        ]
      },
      {
        "name": "fullControlBar",
        "align": "tlabs",
        "x": 0,
        "y": 0,
        "children": [{
          "name": "fullZoom",
          "align": "cc"
        }]
      }
    ]
  }, function (player) {
    console.log(player)
    playerData = player;
    controlVideo(player)
  });

  let sentBox = document.getElementById('sentBox');

  function controlVideo(player) {
    player.tag.addEventListener("x5videoexitfullscreen", function () {
      window.onresize = function () {
        player._el.style.overflow = 'hidden';
        player._el.style.width = '100%';
        player._el.style.height = '5.12rem';
        player.tag.style.width = '100%';
        player.tag.style.height = '5.12rem';
        player.tag.style.objectFit = 'contain';
        sentBox.style.display = 'block';
      }
    });

    player.tag.addEventListener("x5videoenterfullscreen", function () {
      window.onresize = function () {
        player.tag.setAttribute("x5_type", "h5");
        player.tag.setAttribute("x5_fullscreen", "true");
        player.tag.setAttribute("x5_video_position", "top");
        player._el.style.overflow = 'auto';
        player._el.width = '100%';
        player._el.style.height = window.screen.width + 'px';
        player.tag.style.width = '100%';
        player.tag.style.height = window.screen.width + 'px';
        player.tag.style.objectFit = 'fill';
        sentBox.style.display = 'none';
      }
    })

  }

  let textarea = document.getElementById('msg'),
    sentBtn = document.getElementById('sentBtn'),
    chatRoom = document.getElementById('chatRoom'),
    chatWrap = document.getElementById('chatWrap');
  chatRoom.style.height = (chatWrap.clientHeight - sentBox.clientHeight) + 'px';
  sentBtn.addEventListener('click', sent);
  textarea.addEventListener('keyup', changeHeight);
  textarea.addEventListener('keydown', changeHeight);
  // textarea.addEventListener('onkeypress', changeHeight);

  function changeHeight(player) {
    window.onresize = function () {
      playerData._el.style.overflow = 'hidden';
      playerData._el.style.width = window.screen.width + 'px';
      playerData._el.style.height = '5.12rem';
      playerData.tag.style.width = window.screen.width + 'px';
      playerData.tag.style.height = '5.12rem';
      playerData.tag.style.objectFit = 'contain';
    }
    sentBox.style.height = 'auto'; 
    textarea.style.height = textarea.scrollHeight + 'px';
    sentBox.style.position = 'fixed';
    sentBox.style.bottom = '0';
  }

  function sent() {
    let noData = document.getElementById('noData');
    if (!!noData) chatRoom.removeChild(noData);
    let msg = textarea.value;
    let html =
      `<div class="chat_msg">
        <span>小蜡姬 16:42</span>
        <p>${msg}</p>
      </div>
      <div class="chat_img">
        <img src="http://placeholder.qiniudn.com/60x60/3cc51f/ffffff" alt="">
      </div>`;
    let newDiv = document.createElement('div');
    newDiv.className = 'user_chat';
    newDiv.innerHTML = html;
    chatRoom.appendChild(newDiv);
    chatRoom.scrollTop = chatRoom.scrollHeight - sentBox.scrollHeight;
    textarea.value = '';
    textarea.style.height = '.58rem';
    sentBox.style.height = '.98rem';
    sentBox.style.position = 'absolute';
    sentBox.style.bottom = '0';
  }

  function noData() {
    let chatRoom = document.getElementById('chatRoom');
    let list = chatRoom.getElementsByClassName('chat_box');
    if (list.length === 0) {
      let newDiv = document.createElement('div');
      let html =
        `<img src="./images/nodata.png" alt="暂无留言">
      <p>暂无发言</p>`;
      newDiv.className = 'no_data';
      newDiv.id = 'noData';
      newDiv.innerHTML = html;
      chatRoom.appendChild(newDiv);
    }
  }
  noData()
</script>

</html>